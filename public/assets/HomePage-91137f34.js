import{r as s,u as D,j as t,c as b,N as U,l as W,S as J,m as M,h as $,k as y,g as K,L as Q}from"./index-422da41d.js";import{u as X}from"./useLazyImage-dad6eb30.js";import{a as Y,b as Z,C as ee}from"./CardText-7552936b.js";import{I as te,D as T}from"./DropDown-23b60b98.js";import{F as A}from"./FormCheckInput-a1ca7398.js";import"./useWindow-c6c91e90.js";import"./Button-7ea9ceb8.js";const G=s.forwardRef(({className:e,bsPrefix:a,as:c="span",...n},u)=>(a=D(a,"input-group-text"),t.jsx(c,{ref:u,className:b(e,a),...n})));G.displayName="InputGroupText";const w=G,re=e=>t.jsx(w,{children:t.jsx(A,{type:"checkbox",...e})}),ae=e=>t.jsx(w,{children:t.jsx(A,{type:"radio",...e})}),H=s.forwardRef(({bsPrefix:e,size:a,hasValidation:c,className:n,as:u="div",...l},g)=>{e=D(e,"input-group");const f=s.useMemo(()=>({}),[]);return t.jsx(te.Provider,{value:f,children:t.jsx(u,{ref:g,...l,className:b(n,e,a&&`${e}-${a}`,c&&"has-validation")})})});H.displayName="InputGroup";const se=Object.assign(H,{Text:w,Radio:ae,Checkbox:re}),ne="_cards_17vfb_1",E={cards:ne,"no-images":"_no-images_17vfb_14","loading-images":"_loading-images_17vfb_18"},oe="_card_5gbq9_1",ce="_header_5gbq9_14",ie="_image_5gbq9_24",le="_loaded_5gbq9_40",ue="_footer_5gbq9_68",de="_category_5gbq9_72",C={card:oe,header:ce,"image-wrapper":"_image-wrapper_5gbq9_24",image:ie,loaded:le,"loading-img":"_loading-img_5gbq9_43","loading-image":"_loading-image_5gbq9_1",footer:ue,category:de};function ge({title:e,id:a,category:c,stateToListenTo:n}){const[u,l]=X({title:e,id:a,size:"medium"});return s.useEffect(()=>{l()},[n]),t.jsxs(U,{to:`/views?id=${a}`,className:`card text-center ${C.card}`,children:[t.jsx(Y,{className:C.header,children:t.jsx("h2",{children:e})}),u,t.jsx(Z,{className:C.footer,children:t.jsxs(ee,{className:C.category,children:["Category: ",c]})})]})}const I={"search-bar-wrapper":"_search-bar-wrapper_fc2ct_1","search-section":"_search-section_fc2ct_6","search-input":"_search-input_fc2ct_6","spinner-wrapper":"_spinner-wrapper_fc2ct_14"},me=["All",...W],fe=["Date","Title","Category"];function he(e){const[a,c]=s.useState(!1),[n,u]=s.useState("");s.useEffect(()=>{c(!0);const o=setTimeout(()=>{var m;(m=e.onChange)==null||m.call(e,n),c(!1)},350);return()=>{clearTimeout(o),c(!1)}},[n]);const l=o=>{var m;(m=e.onSelectCategory)==null||m.call(e,o)},g=o=>{var m;(m=e.onSelectSort)==null||m.call(e,o)},f=o=>{u(o.target.value)};return t.jsxs("div",{className:I["search-bar-wrapper"],children:[t.jsxs(se,{className:I["search-section"],children:[t.jsx("input",{onChange:f,type:"text",className:`form-control ${I["search-input"]}`,placeholder:"Search..."}),t.jsx(T,{title:"Sort by",onSelect:g,categories:fe,default:"Date"}),t.jsx(T,{title:"Filter",onSelect:l,categories:me,default:"All"})]}),a&&t.jsx("div",{className:I["spinner-wrapper"],children:t.jsx(J,{animation:"border",variant:"primary"})})]})}const pe="_error_ldxu1_1",_e={error:pe},xe=e=>t.jsx("p",{className:_e.error,children:e.message}),R=(e,a,c,n)=>async function(u){const l=`${$}/get-slice?limit=${a}&offset=${e}`,f=await(await fetch(l,{method:"GET",headers:{loadedItems:n?n.join(","):"",token:M()??""}})).json();u({type:"ADD_IMAGE_ITEMS",payload:f.data}),c==null||c(),f.hasMore||u({type:"HAS_NO_MORE_ITEMS"})},ye=(e,a)=>async function(c){const n=`${$}/get?category=${e.toLowerCase()}`,l=await(await fetch(n,{method:"GET",headers:{loadedItems:a?a.join(","):"",token:M()??""}})).json();c({type:"ADD_IMAGE_ITEMS",payload:l})},Ce=600;function Ee(){const e=y(r=>r.hasMoreItems),a=y(r=>r.imageItems),c=y(r=>r.loadedCategories),n=K(),[u,l]=s.useState(!1),[g,f]=s.useState(""),[o,m]=s.useState("All"),[h,k]=s.useState("Date"),q=y(r=>r.initialRender),S=s.useRef(null),_=s.useRef(3),p=s.useRef(6),x=s.useRef(0),L=s.useRef(a.map(r=>r.id));function F(r){const i=Math.max(Math.ceil(r.clientHeight/Ce*_.current),_.current);return Math.ceil(i/3)*3}const j=()=>{if(window.innerWidth<768){_.current=1,p.current=3;return}_.current=3,p.current=6},z=async r=>{n({type:"INITIAL_RENDER"}),x.current=r+p.current,l(!0),await n(R(0,x.current,void 0,a.map(i=>i.id))),l(!1)},V=()=>{const r=()=>{l(!1)};n(R(x.current,p.current,r,L.current)),x.current+=p.current},N=()=>{j()};s.useEffect(()=>{(async()=>{if(!e||o==="All"||c.includes(o))return;l(!0);const i=a.filter(d=>d.category===o).map(d=>d.id);await n(ye(o,i)),l(!1)})()},[o]),s.useEffect(()=>{if(e){if(j(),S.current){const r=F(S.current);q||z(r),j(),window.addEventListener("resize",N)}return()=>{window.removeEventListener("resize",N)}}},[]);function B(r){if(!e)return;const i=r.target,d=i.scrollHeight-i.scrollTop-i.clientHeight;Math.abs(d)<25&&!u&&(l(!0),V())}const v=s.useMemo(()=>{const r=[...a].sort((i,d)=>h==="Title"?i.title.localeCompare(d.title):h==="Category"?i.category.localeCompare(d.category):h==="Date"?new Date(i.date).getTime()-new Date(d.date).getTime():i.id-d.id);return o==="All"&&!g?r:r.filter(i=>{const d=o==="All"||i.category===o,P=!g||i.title.toLowerCase().includes(g.toLowerCase());return d&&P})},[o,g,a,h]),O=!v.length&&!u?t.jsx(xe,{message:"No images found"}):t.jsxs(t.Fragment,{children:[v.map(r=>s.createElement(ge,{stateToListenTo:h,...r,key:r.id})),e&&o==="All"&&!g&&t.jsx(Q,{fullScreen:!1,className:E["loading-images"]})]});return t.jsxs(t.Fragment,{children:[t.jsx(he,{onSelectCategory:m,onChange:f,onSelectSort:k}),t.jsx("div",{onScroll:B,className:E.cards,ref:S,children:O})]})}export{Ee as default};
