import{r as s,u as M,j as t,c as b,N as Q,k as X,S as Y,l as A,g as G,i as C,f as Z,L as ee}from"./index-a92a2e79.js";import{u as te}from"./useLazyImage-cf8d723b.js";import{a as re,b as se,C as ae}from"./CardText-4e5f6be9.js";import{I as ne,D as $}from"./DropDown-8f4dec7b.js";import{F as H}from"./FormCheckInput-05a6970d.js";import oe from"./PageNotFound-2811cb32.js";import"./DataKey-852cb963.js";import"./useWindow-ee83e482.js";import"./mergeOptionsWithPopperConfig-b756c39e.js";import"./Button-58481d39.js";import"./index-02c45f2e.js";const L=s.forwardRef(({className:e,bsPrefix:a,as:c="span",...n},l)=>(a=M(a,"input-group-text"),t.jsx(c,{ref:l,className:b(e,a),...n})));L.displayName="InputGroupText";const R=L,ce=e=>t.jsx(R,{children:t.jsx(H,{type:"checkbox",...e})}),ie=e=>t.jsx(R,{children:t.jsx(H,{type:"radio",...e})}),F=s.forwardRef(({bsPrefix:e,size:a,hasValidation:c,className:n,as:l="div",...i},d)=>{e=M(e,"input-group");const f=s.useMemo(()=>({}),[]);return t.jsx(ne.Provider,{value:f,children:t.jsx(l,{ref:d,...i,className:b(n,e,a&&`${e}-${a}`,c&&"has-validation")})})});F.displayName="InputGroup";const le=Object.assign(F,{Text:R,Radio:ie,Checkbox:ce}),ue="_cards_1u0rk_1",de="_grid_1u0rk_5",me="_visible_1u0rk_20",x={"cards-wrapper":"_cards-wrapper_1u0rk_1",cards:ue,grid:de,"no-images":"_no-images_1u0rk_10","loading-images":"_loading-images_1u0rk_14",visible:me},ge="_card_l10n0_1",fe="_header_l10n0_14",pe="_image_l10n0_24",he="_loaded_l10n0_40",_e="_footer_l10n0_68",xe="_category_l10n0_72",S={card:ge,header:fe,"image-wrapper":"_image-wrapper_l10n0_24",image:pe,loaded:he,"loading-img":"_loading-img_l10n0_43","loading-image":"_loading-image_l10n0_1",footer:_e,category:xe};function ye({title:e,id:a,category:c,stateToListenTo:n}){const[l,i]=te({title:e,id:a,size:"medium"});return s.useEffect(()=>{i()},[n]),t.jsxs(Q,{to:`/views?id=${a}`,className:`card text-center ${S.card}`,children:[t.jsx(re,{className:S.header,children:t.jsx("h2",{children:e})}),l,t.jsx(se,{className:S.footer,children:t.jsxs(ae,{className:S.category,children:["Category: ",c]})})]})}const j={"search-bar-wrapper":"_search-bar-wrapper_fc2ct_1","search-section":"_search-section_fc2ct_6","search-input":"_search-input_fc2ct_6","spinner-wrapper":"_spinner-wrapper_fc2ct_14"},Ie=["All",...X],we=["Date","Title","Category"];function Ce(e){const[a,c]=s.useState(!1),[n,l]=s.useState("");s.useEffect(()=>{c(!0);const o=setTimeout(()=>{var m;(m=e.onChange)==null||m.call(e,n),c(!1)},350);return()=>{clearTimeout(o),c(!1)}},[n]);const i=o=>{var m;(m=e.onSelectCategory)==null||m.call(e,o)},d=o=>{var m;(m=e.onSelectSort)==null||m.call(e,o)},f=o=>{l(o.target.value)};return t.jsxs("div",{className:j["search-bar-wrapper"],children:[t.jsxs(le,{className:j["search-section"],children:[t.jsx("input",{onChange:f,type:"text",className:`form-control ${j["search-input"]}`,placeholder:"Search..."}),t.jsx($,{title:"Sort by",onSelect:d,categories:we,default:"Date"}),t.jsx($,{title:"Filter",onSelect:i,categories:Ie,default:"All"})]}),a&&t.jsx("div",{className:j["spinner-wrapper"],children:t.jsx(Y,{animation:"border",variant:"primary"})})]})}const k=(e,a,c,n)=>async function(l){const i=`${G}/get-slice?limit=${a}&offset=${e}`,f=await(await fetch(i,{method:"GET",headers:{loadedItems:n?n.join(","):"",token:A()??""}})).json();l({type:"ADD_IMAGE_ITEMS",payload:f.data}),c==null||c(),f.hasMore||l({type:"HAS_NO_MORE_ITEMS"})},Se=(e,a)=>async function(c){const n=`${G}/get?category=${e.toLowerCase()}`,i=await(await fetch(n,{method:"GET",headers:{loadedItems:a?a.join(","):"",token:A()??""}})).json();c({type:"ADD_IMAGE_ITEMS",payload:i})},je=600;function Ge(){const e=C(r=>r.hasMoreItems),a=C(r=>r.imageItems),c=C(r=>r.loadedCategories),n=Z(),[l,i]=s.useState(!1),[d,f]=s.useState(""),[o,m]=s.useState("All"),[h,z]=s.useState("Date"),O=C(r=>r.initialRender),p=s.useRef(null),[V,B]=s.useState(!1),y=s.useRef(new IntersectionObserver(([r])=>{r.isIntersecting&&!l&&q()},{root:null,rootMargin:"20px",threshold:.1})),v=s.useRef(null),I=s.useRef(3),_=s.useRef(6),w=s.useRef(0),P=s.useRef(a.map(r=>r.id));function U(r){const u=Math.max(Math.ceil(r.clientHeight/je*I.current),I.current);return Math.ceil(u/3)*3}const N=()=>{if(window.innerWidth<768){I.current=1,_.current=3;return}I.current=3,_.current=6},W=async r=>{n({type:"INITIAL_RENDER"}),w.current=r+_.current,i(!0),await n(k(0,w.current,void 0,a.map(u=>u.id))),i(!1)},q=()=>{const r=()=>{i(!1)};n(k(w.current,_.current,r,P.current)),w.current+=_.current},E=()=>{N()};s.useEffect(()=>{(async()=>{if(!e||o==="All"||c.includes(o))return;i(!0);const u=a.filter(g=>g.category===o).map(g=>g.id);await n(Se(o,u)),i(!1)})()},[o]),s.useEffect(()=>{B(!0)},[]),s.useEffect(()=>{p.current&&(y.current.unobserve(p.current),y.current.observe(p.current))},[d]),s.useEffect(()=>{if(e){if(p.current&&y.current.observe(p.current),N(),v.current){const r=U(v.current);O||W(r),N(),window.addEventListener("resize",E)}return()=>{window.removeEventListener("resize",E),p.current&&y.current.unobserve(p.current)}}},[V]);const T=s.useMemo(()=>{const r=[...a].sort((u,g)=>h==="Title"?u.title.localeCompare(g.title):h==="Category"?u.category.localeCompare(g.category):h==="Date"?new Date(u.date).getTime()-new Date(g.date).getTime():u.id-g.id);return o==="All"&&!d?r:r.filter(u=>{const g=o==="All"||u.category===o,K=!d||u.title.toLowerCase().includes(d.toLowerCase());return g&&K})},[o,d,a,h]),D=!T.length&&!l,J=D?t.jsx(oe,{message:"No images were found!"}):t.jsx(t.Fragment,{children:T.map(r=>s.createElement(ye,{stateToListenTo:h,...r,key:r.id}))});return t.jsxs(t.Fragment,{children:[t.jsx(Ce,{onSelectCategory:m,onChange:f,onSelectSort:z}),t.jsx("div",{className:x["cards-wrapper"],children:t.jsxs("div",{className:`${x.cards} ${D?"":x.grid}`,ref:v,children:[J,t.jsx(ee,{ref:p,fullScreen:!1,className:`${x["loading-images"]} ${e&&o==="All"&&!d?x.visible:""}`})]})})]})}export{Ge as default};
