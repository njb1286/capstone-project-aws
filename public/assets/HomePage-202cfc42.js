import{r as s,u as M,j as t,c as A,N as Q,k as X,S as Y,l as G,g as k,i as C,f as Z,L as ee}from"./index-31c29614.js";import{u as te}from"./useLazyImage-6895c129.js";import{a as re,b as se,C as ae}from"./CardText-32fa2db2.js";import{I as ne,D}from"./DropDown-67fd6291.js";import{F as q}from"./FormCheckInput-ec6021fd.js";import oe from"./PageNotFound-15bb2727.js";import"./DataKey-d38ab4eb.js";import"./useWindow-a7f652f8.js";import"./mergeOptionsWithPopperConfig-bacf5900.js";import"./Button-0b059426.js";import"./index-305457a6.js";const H=s.forwardRef(({className:e,bsPrefix:a,as:c="span",...n},l)=>(a=M(a,"input-group-text"),t.jsx(c,{ref:l,className:A(e,a),...n})));H.displayName="InputGroupText";const b=H,ce=e=>t.jsx(b,{children:t.jsx(q,{type:"checkbox",...e})}),ie=e=>t.jsx(b,{children:t.jsx(q,{type:"radio",...e})}),L=s.forwardRef(({bsPrefix:e,size:a,hasValidation:c,className:n,as:l="div",...i},d)=>{e=M(e,"input-group");const f=s.useMemo(()=>({}),[]);return t.jsx(ne.Provider,{value:f,children:t.jsx(l,{ref:d,...i,className:A(n,e,a&&`${e}-${a}`,c&&"has-validation")})})});L.displayName="InputGroup";const le=Object.assign(L,{Text:b,Radio:ie,Checkbox:ce}),ue="_cards_1w136_1",de="_grid_1w136_5",ge="_visible_1w136_27",w={"cards-wrapper":"_cards-wrapper_1w136_1",cards:ue,grid:de,"no-images":"_no-images_1w136_17","loading-images":"_loading-images_1w136_21",visible:ge},me="_card_5gbq9_1",fe="_header_5gbq9_14",pe="_image_5gbq9_24",he="_loaded_5gbq9_40",_e="_footer_5gbq9_68",we="_category_5gbq9_72",S={card:me,header:fe,"image-wrapper":"_image-wrapper_5gbq9_24",image:pe,loaded:he,"loading-img":"_loading-img_5gbq9_43","loading-image":"_loading-image_5gbq9_1",footer:_e,category:we};function xe({title:e,id:a,category:c,stateToListenTo:n}){const[l,i]=te({title:e,id:a,size:"medium"});return s.useEffect(()=>{i()},[n]),t.jsxs(Q,{to:`/views?id=${a}`,className:`card text-center ${S.card}`,children:[t.jsx(re,{className:S.header,children:t.jsx("h2",{children:e})}),l,t.jsx(se,{className:S.footer,children:t.jsxs(ae,{className:S.category,children:["Category: ",c]})})]})}const j={"search-bar-wrapper":"_search-bar-wrapper_fc2ct_1","search-section":"_search-section_fc2ct_6","search-input":"_search-input_fc2ct_6","spinner-wrapper":"_spinner-wrapper_fc2ct_14"},ye=["All",...X],Ie=["Date","Title","Category"];function Ce(e){const[a,c]=s.useState(!1),[n,l]=s.useState("");s.useEffect(()=>{c(!0);const o=setTimeout(()=>{var g;(g=e.onChange)==null||g.call(e,n),c(!1)},350);return()=>{clearTimeout(o),c(!1)}},[n]);const i=o=>{var g;(g=e.onSelectCategory)==null||g.call(e,o)},d=o=>{var g;(g=e.onSelectSort)==null||g.call(e,o)},f=o=>{l(o.target.value)};return t.jsxs("div",{className:j["search-bar-wrapper"],children:[t.jsxs(le,{className:j["search-section"],children:[t.jsx("input",{onChange:f,type:"text",className:`form-control ${j["search-input"]}`,placeholder:"Search..."}),t.jsx(D,{title:"Sort by",onSelect:d,categories:Ie,default:"Date"}),t.jsx(D,{title:"Filter",onSelect:i,categories:ye,default:"All"})]}),a&&t.jsx("div",{className:j["spinner-wrapper"],children:t.jsx(Y,{animation:"border",variant:"primary"})})]})}const $=(e,a,c,n)=>async function(l){const i=`${k}/get-slice?limit=${a}&offset=${e}`,f=await(await fetch(i,{method:"GET",headers:{loadedItems:n?n.join(","):"",token:G()??""}})).json();l({type:"ADD_IMAGE_ITEMS",payload:f.data}),c==null||c(),f.hasMore||l({type:"HAS_NO_MORE_ITEMS"})},Se=(e,a)=>async function(c){const n=`${k}/get?category=${e.toLowerCase()}`,i=await(await fetch(n,{method:"GET",headers:{loadedItems:a?a.join(","):"",token:G()??""}})).json();c({type:"ADD_IMAGE_ITEMS",payload:i})},je=600;function ke(){const e=C(r=>r.hasMoreItems),a=C(r=>r.imageItems),c=C(r=>r.loadedCategories),n=Z(),[l,i]=s.useState(!1),[d,f]=s.useState(""),[o,g]=s.useState("All"),[h,F]=s.useState("Date"),z=C(r=>r.initialRender),p=s.useRef(null),[O,V]=s.useState(!1),x=s.useRef(new IntersectionObserver(([r])=>{r.isIntersecting&&!l&&W()},{root:null,rootMargin:"20px",threshold:.1})),v=s.useRef(null),y=s.useRef(3),_=s.useRef(6),I=s.useRef(0),B=s.useRef(a.map(r=>r.id));function P(r){const u=Math.max(Math.ceil(r.clientHeight/je*y.current),y.current);return Math.ceil(u/3)*3}const N=()=>{if(window.innerWidth<768){y.current=1,_.current=3;return}y.current=3,_.current=6},U=async r=>{n({type:"INITIAL_RENDER"}),I.current=r+_.current,i(!0),await n($(0,I.current,void 0,a.map(u=>u.id))),i(!1)},W=()=>{const r=()=>{i(!1)};n($(I.current,_.current,r,B.current)),I.current+=_.current},R=()=>{N()};s.useEffect(()=>{(async()=>{if(!e||o==="All"||c.includes(o))return;i(!0);const u=a.filter(m=>m.category===o).map(m=>m.id);await n(Se(o,u)),i(!1)})()},[o]),s.useEffect(()=>{V(!0)},[]),s.useEffect(()=>{p.current&&(x.current.unobserve(p.current),x.current.observe(p.current))},[d]),s.useEffect(()=>{if(e){if(p.current&&x.current.observe(p.current),N(),v.current){const r=P(v.current);z||U(r),N(),window.addEventListener("resize",R)}return()=>{window.removeEventListener("resize",R),p.current&&x.current.unobserve(p.current)}}},[O]);const E=s.useMemo(()=>{const r=[...a].sort((u,m)=>h==="Title"?u.title.localeCompare(m.title):h==="Category"?u.category.localeCompare(m.category):h==="Date"?new Date(u.date).getTime()-new Date(m.date).getTime():u.id-m.id);return o==="All"&&!d?r:r.filter(u=>{const m=o==="All"||u.category===o,K=!d||u.title.toLowerCase().includes(d.toLowerCase());return m&&K})},[o,d,a,h]),T=!E.length&&!l,J=T?t.jsx(oe,{message:"No images were found!"}):t.jsx(t.Fragment,{children:E.map(r=>s.createElement(xe,{stateToListenTo:h,...r,key:r.id}))});return t.jsxs(t.Fragment,{children:[t.jsx(Ce,{onSelectCategory:g,onChange:f,onSelectSort:F}),t.jsx("div",{className:w["cards-wrapper"],children:t.jsxs("div",{className:`${w.cards} ${T?"":w.grid}`,ref:v,children:[J,t.jsx(ee,{ref:p,fullScreen:!1,className:`${w["loading-images"]} ${e&&o==="All"&&!d?w.visible:""}`})]})})]})}export{ke as default};
