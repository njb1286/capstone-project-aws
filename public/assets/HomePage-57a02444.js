import{r as a,u as M,j as t,c as A,N as Q,k as X,S as Y,l as G,g as k,i as I,f as Z,L as ee}from"./index-6c100cd4.js";import{u as te}from"./useLazyImage-13257cee.js";import{a as re,b as ae,C as se}from"./CardText-e84bc889.js";import{I as ne,D}from"./DropDown-0a653e98.js";import{F as q}from"./FormCheckInput-365b67ca.js";import oe from"./PageNotFound-146f202a.js";import"./DataKey-95b4b59e.js";import"./useWindow-90552efc.js";import"./mergeOptionsWithPopperConfig-0fdd69a4.js";import"./Button-0b973d54.js";import"./index-9bdda727.js";const H=a.forwardRef(({className:e,bsPrefix:s,as:c="span",...n},l)=>(s=M(s,"input-group-text"),t.jsx(c,{ref:l,className:A(e,s),...n})));H.displayName="InputGroupText";const N=H,ce=e=>t.jsx(N,{children:t.jsx(q,{type:"checkbox",...e})}),ie=e=>t.jsx(N,{children:t.jsx(q,{type:"radio",...e})}),L=a.forwardRef(({bsPrefix:e,size:s,hasValidation:c,className:n,as:l="div",...i},d)=>{e=M(e,"input-group");const f=a.useMemo(()=>({}),[]);return t.jsx(ne.Provider,{value:f,children:t.jsx(l,{ref:d,...i,className:A(n,e,s&&`${e}-${s}`,c&&"has-validation")})})});L.displayName="InputGroup";const le=Object.assign(L,{Text:N,Radio:ie,Checkbox:ce}),ue="_cards_vi8gv_1",de="_grid_vi8gv_4",ge="_visible_vi8gv_27",v={cards:ue,grid:de,"no-images":"_no-images_vi8gv_17","loading-images":"_loading-images_vi8gv_21",visible:ge},me="_card_5gbq9_1",fe="_header_5gbq9_14",he="_image_5gbq9_24",pe="_loaded_5gbq9_40",_e="_footer_5gbq9_68",xe="_category_5gbq9_72",C={card:me,header:fe,"image-wrapper":"_image-wrapper_5gbq9_24",image:he,loaded:pe,"loading-img":"_loading-img_5gbq9_43","loading-image":"_loading-image_5gbq9_1",footer:_e,category:xe};function ye({title:e,id:s,category:c,stateToListenTo:n}){const[l,i]=te({title:e,id:s,size:"medium"});return a.useEffect(()=>{i()},[n]),t.jsxs(Q,{to:`/views?id=${s}`,className:`card text-center ${C.card}`,children:[t.jsx(re,{className:C.header,children:t.jsx("h2",{children:e})}),l,t.jsx(ae,{className:C.footer,children:t.jsxs(se,{className:C.category,children:["Category: ",c]})})]})}const S={"search-bar-wrapper":"_search-bar-wrapper_fc2ct_1","search-section":"_search-section_fc2ct_6","search-input":"_search-input_fc2ct_6","spinner-wrapper":"_spinner-wrapper_fc2ct_14"},Ie=["All",...X],ve=["Date","Title","Category"];function Ce(e){const[s,c]=a.useState(!1),[n,l]=a.useState("");a.useEffect(()=>{c(!0);const o=setTimeout(()=>{var g;(g=e.onChange)==null||g.call(e,n),c(!1)},350);return()=>{clearTimeout(o),c(!1)}},[n]);const i=o=>{var g;(g=e.onSelectCategory)==null||g.call(e,o)},d=o=>{var g;(g=e.onSelectSort)==null||g.call(e,o)},f=o=>{l(o.target.value)};return t.jsxs("div",{className:S["search-bar-wrapper"],children:[t.jsxs(le,{className:S["search-section"],children:[t.jsx("input",{onChange:f,type:"text",className:`form-control ${S["search-input"]}`,placeholder:"Search..."}),t.jsx(D,{title:"Sort by",onSelect:d,categories:ve,default:"Date"}),t.jsx(D,{title:"Filter",onSelect:i,categories:Ie,default:"All"})]}),s&&t.jsx("div",{className:S["spinner-wrapper"],children:t.jsx(Y,{animation:"border",variant:"primary"})})]})}const $=(e,s,c,n)=>async function(l){const i=`${k}/get-slice?limit=${s}&offset=${e}`,f=await(await fetch(i,{method:"GET",headers:{loadedItems:n?n.join(","):"",token:G()??""}})).json();l({type:"ADD_IMAGE_ITEMS",payload:f.data}),c==null||c(),f.hasMore||l({type:"HAS_NO_MORE_ITEMS"})},Se=(e,s)=>async function(c){const n=`${k}/get?category=${e.toLowerCase()}`,i=await(await fetch(n,{method:"GET",headers:{loadedItems:s?s.join(","):"",token:G()??""}})).json();c({type:"ADD_IMAGE_ITEMS",payload:i})},we=600;function ke(){const e=I(r=>r.hasMoreItems),s=I(r=>r.imageItems),c=I(r=>r.loadedCategories),n=Z(),[l,i]=a.useState(!1),[d,f]=a.useState(""),[o,g]=a.useState("All"),[h,F]=a.useState("Date"),z=I(r=>r.initialRender),p=a.useRef(null),[O,V]=a.useState(!1),R=a.useRef(new IntersectionObserver(([r])=>{r.isIntersecting&&!l&&W()},{root:null,rootMargin:"20px",threshold:.1})),w=a.useRef(null),x=a.useRef(3),_=a.useRef(6),y=a.useRef(0),B=a.useRef(s.map(r=>r.id));function P(r){const u=Math.max(Math.ceil(r.clientHeight/we*x.current),x.current);return Math.ceil(u/3)*3}const j=()=>{if(window.innerWidth<768){x.current=1,_.current=3;return}x.current=3,_.current=6},U=async r=>{n({type:"INITIAL_RENDER"}),y.current=r+_.current,i(!0),await n($(0,y.current,void 0,s.map(u=>u.id))),i(!1)},W=()=>{const r=()=>{i(!1)};n($(y.current,_.current,r,B.current)),y.current+=_.current},b=()=>{j()};a.useEffect(()=>{(async()=>{if(!e||o==="All"||c.includes(o))return;i(!0);const u=s.filter(m=>m.category===o).map(m=>m.id);await n(Se(o,u)),i(!1)})()},[o]),a.useEffect(()=>{V(!0)},[]),a.useEffect(()=>{if(e){if(p.current&&R.current.observe(p.current),j(),w.current){const r=P(w.current);z||U(r),j(),window.addEventListener("resize",b)}return()=>{window.removeEventListener("resize",b),p.current&&R.current.unobserve(p.current)}}},[O]);const E=a.useMemo(()=>{const r=[...s].sort((u,m)=>h==="Title"?u.title.localeCompare(m.title):h==="Category"?u.category.localeCompare(m.category):h==="Date"?new Date(u.date).getTime()-new Date(m.date).getTime():u.id-m.id);return o==="All"&&!d?r:r.filter(u=>{const m=o==="All"||u.category===o,K=!d||u.title.toLowerCase().includes(d.toLowerCase());return m&&K})},[o,d,s,h]),T=!E.length&&!l,J=T?t.jsx(oe,{message:"No images were found!"}):t.jsxs(t.Fragment,{children:[E.map(r=>a.createElement(ye,{stateToListenTo:h,...r,key:r.id})),t.jsx(ee,{ref:p,fullScreen:!1,className:`${v["loading-images"]} ${e&&o==="All"&&!d?v.visible:""}`})]});return t.jsxs(t.Fragment,{children:[t.jsx(Ce,{onSelectCategory:g,onChange:f,onSelectSort:F}),t.jsx("div",{className:`${v.cards} ${T?"":v.grid}`,ref:w,children:J})]})}export{ke as default};
