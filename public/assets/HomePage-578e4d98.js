import{r,u as k,j as t,c as A,S as H,h as b,N as W,l as J,m as L,k as $,g as K,L as Q}from"./index-95294c57.js";import{a as X,b as Y,C as Z}from"./CardText-213e0226.js";import{I as ee,D}from"./DropDown-7b399a6e.js";import{F as q}from"./FormCheckInput-19cef856.js";import"./useWindow-d182fb8b.js";import"./Button-1fdb23ab.js";const z=r.forwardRef(({className:e,bsPrefix:a,as:o="span",...c},u)=>(a=k(a,"input-group-text"),t.jsx(o,{ref:u,className:A(e,a),...c})));z.displayName="InputGroupText";const N=z,te=e=>t.jsx(N,{children:t.jsx(q,{type:"checkbox",...e})}),re=e=>t.jsx(N,{children:t.jsx(q,{type:"radio",...e})}),F=r.forwardRef(({bsPrefix:e,size:a,hasValidation:o,className:c,as:u="div",...i},g)=>{e=k(e,"input-group");const d=r.useMemo(()=>({}),[]);return t.jsx(ee.Provider,{value:d,children:t.jsx(u,{ref:g,...i,className:A(c,e,a&&`${e}-${a}`,o&&"has-validation")})})});F.displayName="InputGroup";const ae=Object.assign(F,{Text:N,Radio:re,Checkbox:te}),se="_cards_17vfb_1",M={cards:se,"no-images":"_no-images_17vfb_14","loading-images":"_loading-images_17vfb_18"},ne="_card_5gbq9_1",oe="_header_5gbq9_14",ce="_image_5gbq9_24",ie="_loaded_5gbq9_40",le="_footer_5gbq9_68",ue="_category_5gbq9_72",v={card:ne,header:oe,"image-wrapper":"_image-wrapper_5gbq9_24",image:ce,loaded:ie,"loading-img":"_loading-img_5gbq9_43","loading-image":"_loading-image_5gbq9_1",footer:le,category:ue},de="_spinner_n1cy7_33",ge="_image_n1cy7_12",me="_loaded_n1cy7_58",fe="_visible_n1cy7_58",I={"image-wrapper":"_image-wrapper_n1cy7_12","loading-img":"_loading-img_n1cy7_15","loading-image":"_loading-image_n1cy7_1","spinner-wrapper":"_spinner-wrapper_n1cy7_33",spinner:de,image:ge,loaded:me,visible:fe},pe=({id:e,wrapperClassName:a,imageClassName:o,title:c,size:u})=>{const[i,g]=r.useState(!1),d=r.useRef(null),[n,m]=r.useState(!1),_=`${b}/get-image?id=${e}&size=small`,j=`${b}/get-image?id=${e}&size=${u??"large"}`,h=r.useRef(!1),p=r.useRef(null);r.useEffect(()=>{if(h.current)return;const S=new Image;if(S.src=_,!n)return;const w=new Image;w.src=j,w.onload=()=>{g(!0)},h.current=!0},[e,n]),r.useEffect(()=>(p.current=new IntersectionObserver(([S])=>{m(S.isIntersecting)},{root:null,rootMargin:"0px",threshold:.1}),d.current&&p.current.observe(d.current),()=>{d.current&&p.current.unobserve(d.current)}),[]);const y=()=>{p.current.unobserve(d.current),p.current.observe(d.current)};let x=t.jsx("img",{alt:c,src:j,loading:"lazy",className:`${o??""} ${I.image} ${n?I.visible:""} ${i?I.loaded:""}`});return!n&&!h.current&&(x=null),[t.jsxs("div",{ref:d,className:`${a} ${I["image-wrapper"]}`,children:[t.jsx("div",{style:{backgroundImage:`url(${_})`},className:I["loading-img"]}),t.jsx("div",{className:I["spinner-wrapper"],children:t.jsx(H,{className:I.spinner,variant:"primary",animation:"border"})}),x]}),y]};function _e({title:e,id:a,category:o,stateToListenTo:c}){const[u,i]=pe({title:e,id:a,size:"medium"});return r.useEffect(()=>{i()},[c]),t.jsxs(W,{to:`/views?id=${a}`,className:`card text-center ${v.card}`,children:[t.jsx(X,{className:v.header,children:t.jsx("h2",{children:e})}),u,t.jsx(Y,{className:v.footer,children:t.jsxs(Z,{className:v.category,children:["Category: ",o]})})]})}const C={"search-bar-wrapper":"_search-bar-wrapper_fc2ct_1","search-section":"_search-section_fc2ct_6","search-input":"_search-input_fc2ct_6","spinner-wrapper":"_spinner-wrapper_fc2ct_14"},he=["All",...J],ye=["Date","Title","Category"];function xe(e){const[a,o]=r.useState(!1),[c,u]=r.useState("");r.useEffect(()=>{o(!0);const n=setTimeout(()=>{var m;(m=e.onChange)==null||m.call(e,c),o(!1)},350);return()=>{clearTimeout(n),o(!1)}},[c]);const i=n=>{var m;(m=e.onSelectCategory)==null||m.call(e,n)},g=n=>{var m;(m=e.onSelectSort)==null||m.call(e,n)},d=n=>{u(n.target.value)};return t.jsxs("div",{className:C["search-bar-wrapper"],children:[t.jsxs(ae,{className:C["search-section"],children:[t.jsx("input",{onChange:d,type:"text",className:`form-control ${C["search-input"]}`,placeholder:"Search..."}),t.jsx(D,{title:"Sort by",onSelect:g,categories:ye,default:"Date"}),t.jsx(D,{title:"Filter",onSelect:i,categories:he,default:"All"})]}),a&&t.jsx("div",{className:C["spinner-wrapper"],children:t.jsx(H,{animation:"border",variant:"primary"})})]})}const Ie="_error_ldxu1_1",we={error:Ie},Se=e=>t.jsx("p",{className:we.error,children:e.message}),G=(e,a,o,c)=>async function(u){const i=`${b}/get-slice?limit=${a}&offset=${e}`,d=await(await fetch(i,{method:"GET",headers:{loadedItems:c?c.join(","):"",token:L()??""}})).json();u({type:"ADD_IMAGE_ITEMS",payload:d.data}),o==null||o(),d.hasMore||u({type:"HAS_NO_MORE_ITEMS"})},je=(e,a)=>async function(o){const c=`${b}/get?category=${e.toLowerCase()}`,i=await(await fetch(c,{method:"GET",headers:{loadedItems:a?a.join(","):"",token:L()??""}})).json();o({type:"ADD_IMAGE_ITEMS",payload:i})},ve=600;function Te(){const e=$(s=>s.hasMoreItems),a=$(s=>s.imageItems),o=$(s=>s.loadedCategories),c=K(),[u,i]=r.useState(!1),[g,d]=r.useState(""),[n,m]=r.useState("All"),[_,j]=r.useState("Date"),h=r.useRef(null),p=r.useRef(3),y=r.useRef(6),x=r.useRef(0),R=r.useRef(a.map(s=>s.id));function S(s){const l=Math.max(Math.ceil(s.clientHeight/ve*p.current),p.current);return Math.ceil(l/3)*3}const w=()=>{if(window.innerWidth<768){p.current=1,y.current=3;return}p.current=3,y.current=6},O=async s=>{x.current=s+y.current,i(!0),await c(G(0,x.current,void 0,a.map(l=>l.id))),i(!1)},V=()=>{const s=()=>{i(!1)};c(G(x.current,y.current,s,R.current)),x.current+=y.current},E=()=>{w()};r.useEffect(()=>{(async()=>{if(!e||n==="All"||o.includes(n))return;i(!0);const l=a.filter(f=>f.category===n).map(f=>f.id);await c(je(n,l)),i(!1)})()},[n]),r.useEffect(()=>{if(e){if(w(),h.current){const s=S(h.current);O(s),w(),window.addEventListener("resize",E)}return()=>{window.removeEventListener("resize",E)}}},[]);function B(s){if(!e)return;const l=s.target,f=l.scrollHeight-l.scrollTop-l.clientHeight;Math.abs(f)<25&&!u&&(i(!0),V())}const T=r.useMemo(()=>{const s=[...a].sort((l,f)=>_==="Title"?l.title.localeCompare(f.title):_==="Category"?l.category.localeCompare(f.category):_==="Date"?new Date(l.date).getTime()-new Date(f.date).getTime():l.id-f.id);return n==="All"&&!g?s:s.filter(l=>{const f=n==="All"||l.category===n,P=!g||l.title.toLowerCase().includes(g.toLowerCase());return f&&P})},[n,g,a,_]),U=!T.length&&!u?t.jsx(Se,{message:"No images found"}):t.jsxs(t.Fragment,{children:[T.map(s=>r.createElement(_e,{stateToListenTo:_,...s,key:s.id})),e&&n==="All"&&!g&&t.jsx(Q,{fullScreen:!1,className:M["loading-images"]})]});return t.jsxs(t.Fragment,{children:[t.jsx(xe,{onSelectCategory:m,onChange:d,onSelectSort:j}),t.jsx("div",{onScroll:B,className:M.cards,ref:h,children:U})]})}export{Te as default};
