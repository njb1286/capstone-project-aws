import{r as s,u as D,j as t,c as M,N as P,l as U,S as W,m as R,h as $,k as w,g as J,L as K}from"./index-924502c0.js";import{u as Q}from"./useLazyImage-96c1d36b.js";import{a as X,b as Y,C as Z}from"./CardText-8fee4677.js";import{I as ee,D as T}from"./DropDown-d34b0528.js";import{F as G}from"./FormCheckInput-819bf322.js";import"./useWindow-76793841.js";import"./Button-527a8964.js";const A=s.forwardRef(({className:e,bsPrefix:a,as:o="span",...c},u)=>(a=D(a,"input-group-text"),t.jsx(o,{ref:u,className:M(e,a),...c})));A.displayName="InputGroupText";const I=A,te=e=>t.jsx(I,{children:t.jsx(G,{type:"checkbox",...e})}),re=e=>t.jsx(I,{children:t.jsx(G,{type:"radio",...e})}),H=s.forwardRef(({bsPrefix:e,size:a,hasValidation:o,className:c,as:u="div",...l},g)=>{e=D(e,"input-group");const f=s.useMemo(()=>({}),[]);return t.jsx(ee.Provider,{value:f,children:t.jsx(u,{ref:g,...l,className:M(c,e,a&&`${e}-${a}`,o&&"has-validation")})})});H.displayName="InputGroup";const ae=Object.assign(H,{Text:I,Radio:re,Checkbox:te}),se="_cards_17vfb_1",E={cards:se,"no-images":"_no-images_17vfb_14","loading-images":"_loading-images_17vfb_18"},ne="_card_5gbq9_1",oe="_header_5gbq9_14",ce="_image_5gbq9_24",ie="_loaded_5gbq9_40",le="_footer_5gbq9_68",ue="_category_5gbq9_72",y={card:ne,header:oe,"image-wrapper":"_image-wrapper_5gbq9_24",image:ce,loaded:ie,"loading-img":"_loading-img_5gbq9_43","loading-image":"_loading-image_5gbq9_1",footer:le,category:ue};function de({title:e,id:a,category:o,stateToListenTo:c}){const[u,l]=Q({title:e,id:a,size:"medium"});return s.useEffect(()=>{l()},[c]),t.jsxs(P,{to:`/views?id=${a}`,className:`card text-center ${y.card}`,children:[t.jsx(X,{className:y.header,children:t.jsx("h2",{children:e})}),u,t.jsx(Y,{className:y.footer,children:t.jsxs(Z,{className:y.category,children:["Category: ",o]})})]})}const C={"search-bar-wrapper":"_search-bar-wrapper_fc2ct_1","search-section":"_search-section_fc2ct_6","search-input":"_search-input_fc2ct_6","spinner-wrapper":"_spinner-wrapper_fc2ct_14"},ge=["All",...U],me=["Date","Title","Category"];function fe(e){const[a,o]=s.useState(!1),[c,u]=s.useState("");s.useEffect(()=>{o(!0);const n=setTimeout(()=>{var m;(m=e.onChange)==null||m.call(e,c),o(!1)},350);return()=>{clearTimeout(n),o(!1)}},[c]);const l=n=>{var m;(m=e.onSelectCategory)==null||m.call(e,n)},g=n=>{var m;(m=e.onSelectSort)==null||m.call(e,n)},f=n=>{u(n.target.value)};return t.jsxs("div",{className:C["search-bar-wrapper"],children:[t.jsxs(ae,{className:C["search-section"],children:[t.jsx("input",{onChange:f,type:"text",className:`form-control ${C["search-input"]}`,placeholder:"Search..."}),t.jsx(T,{title:"Sort by",onSelect:g,categories:me,default:"Date"}),t.jsx(T,{title:"Filter",onSelect:l,categories:ge,default:"All"})]}),a&&t.jsx("div",{className:C["spinner-wrapper"],children:t.jsx(W,{animation:"border",variant:"primary"})})]})}const he="_error_ldxu1_1",pe={error:he},_e=e=>t.jsx("p",{className:pe.error,children:e.message}),b=(e,a,o,c)=>async function(u){const l=`${$}/get-slice?limit=${a}&offset=${e}`,f=await(await fetch(l,{method:"GET",headers:{loadedItems:c?c.join(","):"",token:R()??""}})).json();u({type:"ADD_IMAGE_ITEMS",payload:f.data}),o==null||o(),f.hasMore||u({type:"HAS_NO_MORE_ITEMS"})},xe=(e,a)=>async function(o){const c=`${$}/get?category=${e.toLowerCase()}`,l=await(await fetch(c,{method:"GET",headers:{loadedItems:a?a.join(","):"",token:R()??""}})).json();o({type:"ADD_IMAGE_ITEMS",payload:l})},ye=600;function Te(){const e=w(r=>r.hasMoreItems),a=w(r=>r.imageItems),o=w(r=>r.loadedCategories),c=J(),[u,l]=s.useState(!1),[g,f]=s.useState(""),[n,m]=s.useState("All"),[h,k]=s.useState("Date"),S=s.useRef(null),_=s.useRef(3),p=s.useRef(6),x=s.useRef(0),q=s.useRef(a.map(r=>r.id));function L(r){const i=Math.max(Math.ceil(r.clientHeight/ye*_.current),_.current);return Math.ceil(i/3)*3}const j=()=>{if(window.innerWidth<768){_.current=1,p.current=3;return}_.current=3,p.current=6},F=async r=>{x.current=r+p.current,l(!0),await c(b(0,x.current,void 0,a.map(i=>i.id))),l(!1)},z=()=>{const r=()=>{l(!1)};c(b(x.current,p.current,r,q.current)),x.current+=p.current},v=()=>{j()};s.useEffect(()=>{(async()=>{if(!e||n==="All"||o.includes(n))return;l(!0);const i=a.filter(d=>d.category===n).map(d=>d.id);await c(xe(n,i)),l(!1)})()},[n]),s.useEffect(()=>{if(e){if(j(),S.current){const r=L(S.current);F(r),j(),window.addEventListener("resize",v)}return()=>{window.removeEventListener("resize",v)}}},[]);function V(r){if(!e)return;const i=r.target,d=i.scrollHeight-i.scrollTop-i.clientHeight;Math.abs(d)<25&&!u&&(l(!0),z())}const N=s.useMemo(()=>{const r=[...a].sort((i,d)=>h==="Title"?i.title.localeCompare(d.title):h==="Category"?i.category.localeCompare(d.category):h==="Date"?new Date(i.date).getTime()-new Date(d.date).getTime():i.id-d.id);return n==="All"&&!g?r:r.filter(i=>{const d=n==="All"||i.category===n,O=!g||i.title.toLowerCase().includes(g.toLowerCase());return d&&O})},[n,g,a,h]),B=!N.length&&!u?t.jsx(_e,{message:"No images found"}):t.jsxs(t.Fragment,{children:[N.map(r=>s.createElement(de,{stateToListenTo:h,...r,key:r.id})),e&&n==="All"&&!g&&t.jsx(K,{fullScreen:!1,className:E["loading-images"]})]});return t.jsxs(t.Fragment,{children:[t.jsx(fe,{onSelectCategory:m,onChange:f,onSelectSort:k}),t.jsx("div",{onScroll:V,className:E.cards,ref:S,children:B})]})}export{Te as default};
